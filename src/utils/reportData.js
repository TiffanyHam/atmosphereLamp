// var res = [
//   //       {
//   //   ts: "20210409T145305Z",
//   //   sid: "brushingHistory",
//   //   data: {
//   //     score: "XXXXXX",
//   //   },
//   // },
//         {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_80",
//       },
//     },
//      {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/15_14:53:05_00:33_90",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
    
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_14:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_16:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/14_18:53:05_00:33_80",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/12_14:53:05_00:33_90",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "2021/04/11_14:53:05_01:02_60",
//       },
//     },
//     {
//       ts: "20210409T145305Z",
//       sid: "brushingHistory",
//       data: {
//         score: "XXXXXX",
//       },
//     },
//   ]
  
//   this.getHistory(res);
  

// console.log('kkk:',data1)
// var list = [
//   "2021/04/14_14:53:05_00:33_80",
//   "2021/04/12_14:53:05_00:33_80",
//   "2021/04/11_14:53:05_01:02_60",
//   "2021/04/11_15:53:05_01:02_60",
//   "2021/03/10_14:53:05_01:33_30",
//   "XXXXXX",
//   "2021/03/11_9:53:05_01:33_30",
//   "2021/03/09_24:53:05_01:33_60",
//   "XXXXXX",
//   "2021/02/09_4:53:05_02:33_45",
// ];
// 操作云端历史数据对象
const reportData = {};

// 云端唯一 id
reportData.devId = "";
// 获取华为云端唯一id
reportData.getDevId = () => {
  // 获取设备信息
  window.getDevInfoAllCallback = (res) => {
    res = JSON.parse(res);
    //console.log('获取华为云端唯一id',res);
    reportData.devId = res.devId;
  };
  window.hilink &&
    window.hilink.getDevInfoAll &&
    window.hilink.getDevInfoAll("0", "", "getDevInfoAllCallback");
};

reportData.formatDataFromMachine = (dayY, timeY, record, score) => {
  let services = [],
    item = {},
    reportTime = new Date().getTime();
  item.ts = reportData.formatTime(reportTime);
  item.sid = "brushingHistory";
  item.data = {
    score: dayY + "_" + timeY + "_" + record + "_" + score,
  };
  services.push(item);
  item = {};
  let res = {
    status: "online",
    services: [...services],
  };
  return res;
};
// 格式化上报时间
reportData.formatTime = (time = null) => {
  // time 要求时间毫秒数
  time = time ? time : new Date().getTime();
  let date = new Date(time);
  let formatTime = "";
  let M = date.getMonth() + 1;
  M = M.toString().length === 1 ? `0${M}` : `${M}`;
  let D =
    date.getDate().toString().length === 1
      ? "0" + date.getDate().toString()
      : date.getDate().toString();
  let H =
    date.getHours().toString().length === 1
      ? "0" + date.getHours().toString()
      : date.getHours().toString();
  let m =
    date.getMinutes().toString().length === 1
      ? "0" + date.getMinutes().toString()
      : date.getMinutes().toString();
  let S =
    date.getSeconds().toString().length === 1
      ? "0" + date.getSeconds().toString()
      : date.getSeconds().toString();
  formatTime += `${date.getFullYear()}${M}${D}T${H}${m}${S}Z`;
  return formatTime;
};

// 上报数据到华为云端
reportData.report = (onlyId, Data = null, func = null) => {
  let json_body = JSON.stringify(Data);
  window.reportDeviceProfileImpermanencyCallback = (res) => {
    if (window.ios) {
      let data = getIOSDevid(res);
      if (data.errCode == 0) {
        let resData = { errcode: 200 };
        if (func) {
          func(resData);
        }
      }
    } else {
      res = JSON.parse(res);
      if (func) {
        func(res);
      }
    }
  };
  window.hilink &&
    window.hilink.reportDeviceProfileImpermanency &&
    window.hilink.reportDeviceProfileImpermanency(
      onlyId,
      json_body,
      "reportDeviceProfileImpermanencyCallback"
    );
};
/**
 * @description: 解析ios devID
 * @param {*}
 * @return {*}
 */
function getIOSDevid(res) {
  let data = undefined;
  let dataStr = res;
  dataStr = dataStr.replace(/"{/g, "{");
  dataStr = dataStr.replace(/}"/g, "}");
  dataStr = dataStr.replace(/\\|\n|\r|\t|\f|\t/g, "");
  data = JSON.parse(dataStr);
  return data;
}
// 获取历史记录
reportData.getHistoryLog = (func = null) => {
  //获取历史记录回调
  let data = null;
  let nowDate = new Date();
  let endTime = reportData.formatTime();
  let startTime = reportData.formatTime(
    nowDate.setMonth(nowDate.getMonth() - 7)
  );
  window.getDevHistoryCallBack = (res) => {
    res = JSON.parse(res);
    data = res.list;
    if (func) {
      func(data);
    }
  };
  console.log(' reportData.devId:',reportData.devId)
  window.hilink &&
    window.hilink.getDevHistory &&
    window.hilink.getDevHistory(
      reportData.devId, // 华为分配的id
      "0",
      "1000",
      startTime,
      endTime,
      "brushingHistory",
      "score",
      "getDevHistoryCallBack"
    );
};

// 特殊数据 用于分割重置后的刷牙历史数据
reportData.resize = (time) => {
  if(localStorage.getItem('current_time')){
    localStorage.removeItem('current_time');
 }
  var times = reportData.formatDate1(Date.parse(new Date())); //当前时间
  localStorage.setItem('current_time', times);

  let specialData = {
    status: "online",
    services: [
      {
        ts: reportData.formatTime(time),
        sid: "brushingHistory",
        data: {
          score: "XXXXXX_"+ times,
        },
      },
    ],
  };
  //console.log("重置数据：", specialData);
  reportData.report(reportData.devId, specialData);
};

/**
 * @description: 日期格式化 2021/4/20
 * @param {*} dd
 * @return {*}
 */
 reportData.formatDate1 = (dd) => {
  var date = new Date(dd);
  var YY = date.getFullYear() + "/";
  var MM =
    (date.getMonth() + 1 < 10
      ? "0" + (date.getMonth() + 1)
      : date.getMonth() + 1) + "/";
  var DD = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
  var hh =
    (date.getHours() < 10 ? "0" + date.getHours() : date.getHours()) + ":";
  var mm =
    (date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes()) +
    ":";
  var ss =
    date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
  return YY + MM + DD;
}

//reportData.getDevId();
export default reportData;
